<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ü™Ñ Compress PDF ‚Ä¢ NiceDay PDF Jar</title>

  <style>
    :root{
      --bg:#fafafa; --card:#ffffff; --ink:#0f172a; --muted:#6b7280;
      --border:#e5e7eb; --brand:#2563eb; --brand-2:#60a5fa; --ring:#93c5fd;
      --ok:#16a34a; --warn:#d97706; --err:#ef4343;
      --shadow:0 10px 28px rgba(2,6,23,.08);
    }
    @media (prefers-color-scheme: dark){
      :root[data-theme="dark"]{
        --bg:#0c0c0e; --card:#151517; --ink:#eceff3; --muted:#a1a1aa;
        --border:#27282c; --brand:#60a5fa; --brand-2:#93c5fd; --ring:#1d4ed8;
        --shadow:0 14px 36px rgba(0,0,0,.45);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
      color:var(--ink);
      background:
        radial-gradient(120% 100% at 100% -10%, color-mix(in oklab, var(--bg), #fff 8%), transparent 60%),
        radial-gradient(140% 100% at 0% 120%, color-mix(in oklab, var(--bg), #000 2%), transparent 60%),
        var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    :focus-visible{outline:2px solid var(--ring); outline-offset:3px; border-radius:10px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Shell */
    .tool-wrap{max-width:960px; margin:28px auto 32px; padding:0 16px}
    .hero{display:flex;align-items:center;gap:12px}
    .logo{
      width:42px;height:42px;border-radius:12px;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      display:grid;place-items:center;color:#fff;box-shadow:var(--shadow);font-weight:900;letter-spacing:.2px
    }
    .logo span{font-size:14px}
    h1{margin:.25rem 0 0;font-size:1.6rem}
    .lead{margin:.1rem 0 0;color:var(--muted)}

    /* Card */
    .tool-card{
      margin-top:16px; background:var(--card); border:1px solid var(--border); border-radius:18px;
      padding:16px; box-shadow:var(--shadow);
    }

    /* Dropzone */
    .drop{
      margin-top:8px; border:1.5px dashed var(--border); border-radius:16px; background:color-mix(in oklab, var(--card), #000 1%);
      padding:18px; display:flex; align-items:center; gap:14px; cursor:pointer;
      transition:border-color .15s ease, background .15s ease, transform .05s ease;
    }
    .drop:hover{border-color:var(--brand)}
    .drop:active{transform:translateY(1px)}
    .drop .ico{
      width:46px;height:46px;border-radius:12px;flex:0 0 auto;
      background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#fff; display:grid; place-items:center; font-size:22px; box-shadow:var(--shadow)
    }
    .drop .txt{display:flex;flex-direction:column}
    .drop .txt strong{font-size:1rem}
    .drop small{color:var(--muted)}
    #cmpInput{display:none}
    .filetag{
      margin-left:auto; padding:8px 12px; border:1px dashed var(--border); border-radius:999px; color:var(--muted); max-width:45%;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      background:color-mix(in oklab, var(--card), #000 2%);
    }

    /* Presets row */
    .presets{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{
      border:1px solid var(--border); background:var(--card); border-radius:999px; padding:.45rem .7rem; cursor:pointer; font-weight:600;
    }
    .chip[data-active="1"]{border-color:var(--brand); box-shadow:0 0 0 3px color-mix(in oklab, var(--brand) 35%, transparent)}

    /* Controls */
    .grid{display:grid;gap:12px;margin-top:12px}
    @media (min-width:720px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    label{display:flex;flex-direction:column;gap:.4rem;font-size:.95rem}
    select,input[type="number"]{
      border:1px solid var(--border); background:var(--card); color:var(--ink);
      border-radius:12px; padding:.65rem .75rem; font-size:.98rem;
    }
    .hint{color:var(--muted); font-size:.85rem; margin-top:.25rem}

    /* Button */
    .btn{
      margin-top:14px; width:100%; border:0; border-radius:12px; padding:.9rem 1rem;
      background:linear-gradient(90deg, color-mix(in oklab, var(--brand) 92%, #fff), var(--brand));
      color:#fff; font-weight:800; cursor:pointer; letter-spacing:.2px;
      box-shadow:0 10px 22px rgba(37,99,235,.25); transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{filter:brightness(1.03)}
    .btn:active{transform:translateY(1px) scale(.99)}

    /* Progress */
    .progress{margin-top:12px;height:12px;width:100%;background:color-mix(in oklab, var(--card), #000 4%);border-radius:999px;overflow:hidden;border:1px solid var(--border);display:none}
    .progress > span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--brand),var(--brand-2));transition:width .12s ease}

    /* Status + tray */
    .status{margin:.6rem 0 0;color:var(--muted);font-size:.92rem;min-height:1.2em}
    .status.ok{color:var(--ok)} .status.warn{color:var(--warn)} .status.err{color:var(--err)}

    .tray{display:grid; grid-template-columns:repeat(auto-fill, minmax(120px,1fr)); gap:10px; margin-top:12px}
    .thumb{border:1px solid var(--border); border-radius:10px; background:var(--card); overflow:hidden; display:flex; align-items:center; justify-content:center; aspect-ratio:3/4}
    .thumb canvas{width:100%; height:100%; object-fit:contain}

    /* Tips + theme */
    .tips{margin-top:16px; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:color-mix(in oklab, var(--card), #000 2%); color:var(--muted); font-size:.92rem}
    .tips ul{margin:.35rem 0 0 1rem}
    .theme{display:inline-flex; gap:.5rem; align-items:center; margin-top:10px; color:var(--muted); font-size:.9rem}
    .theme button{border:1px solid var(--border); background:var(--card); padding:.35rem .6rem; border-radius:999px; cursor:pointer}
  </style>
</head>
<body>
  <main class="tool-wrap" role="main">
    <div class="hero">
      <div class="logo"><span>ND</span></div>
      <div>
        <h1>ü™Ñ Compress PDF</h1>
        <p class="lead">Turn each page into an image and rebuild the PDF. Lower <em>Scale</em> or <em>Quality</em> ‚Üí smaller file.</p>
      </div>
    </div>

    <div class="tool-card" aria-labelledby="uploaderTitle">
      <div id="uploaderTitle" class="sr-only">Upload & settings</div>

      <!-- Drag & drop / pick -->
      <label for="cmpInput" class="drop" id="dropZone" title="Click to choose a PDF or drop one here">
        <div class="ico">üìÑ</div>
        <div class="txt">
          <strong>Drop your PDF here, or click to choose</strong>
          <small>Single PDF ‚Ä¢ Up to a few hundred pages works well</small>
        </div>
        <span id="fileTag" class="filetag">No file chosen</span>
      </label>
      <input id="cmpInput" type="file" accept="application/pdf" aria-label="Choose PDF to compress" />

      <!-- Quick presets -->
      <div class="presets" role="group" aria-label="Quick presets">
        <button class="chip" data-preset="max">üìà Max quality</button>
        <button class="chip" data-preset="bal" data-active="1">‚öñÔ∏è Balanced (recommended)</button>
        <button class="chip" data-preset="small">üì¶ Smallest file</button>
      </div>

      <!-- Controls -->
      <div class="grid" role="group" aria-label="Compression settings">
        <label for="cmpScale">Scale
          <select id="cmpScale">
            <option value="1">1.0 (max clarity)</option>
            <option value="0.8" selected>0.8</option>
            <option value="0.6">0.6</option>
            <option value="0.5">0.5 (smallest)</option>
          </select>
          <span class="hint">Renders each page smaller. <em>0.8</em> is a good balance.</span>
        </label>

        <label for="cmpQuality">Quality (JPEG 0.3‚Äì0.95)
          <input id="cmpQuality" type="number" min="0.3" max="0.95" step="0.05" value="0.8" />
          <span class="hint">Compression level for JPG output. Lower = smaller file, softer images.</span>
        </label>

        <label for="cmpFormat">Format
          <select id="cmpFormat">
            <option value="jpeg" selected>JPG (smaller)</option>
            <option value="png">PNG (larger, sharper lines)</option>
          </select>
          <span class="hint">Use PNG for line art/diagrams; JPG for photos or mixed pages.</span>
        </label>
      </div>

      <button id="cmpBtn" class="btn">Compress &amp; Download</button>

      <div class="progress" id="cmpProgress" aria-hidden="true" aria-label="Compression progress">
        <span id="cmpBar"></span>
      </div>

      <p id="cmpStatus" class="status" aria-live="polite"></p>

      <div class="tray" id="cmpTray" aria-live="polite" aria-label="Page previews (first few)"></div>

      <div class="tips" aria-label="Helpful tips">
        <strong>Tips:</strong>
        <ul>
          <li><b>Balanced</b> preset (Scale 0.8, Quality 0.8) often gives ~70‚Äì85% smaller files.</li>
          <li>Scanning photos? Keep <em>JPG</em>. Engineering drawings? Try <em>PNG</em> for crisp lines.</li>
          <li>Big PDFs take time. Keeping this tab visible helps browsers stay fast.</li>
        </ul>
      </div>

      <div class="theme" role="group" aria-label="Theme">
        Theme:
        <button type="button" id="lightBtn">Light</button>
        <button type="button" id="darkBtn">Dark</button>
      </div>
    </div>
  </main>

  <!-- libs (same versions you used) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- your compressor logic (unchanged) -->
  <script src="compress.js"></script>

  <!-- small UI helpers (safe to keep inline) -->
  <script>
    const root = document.documentElement;
    document.getElementById('lightBtn')?.addEventListener('click', ()=>root.setAttribute('data-theme','light'));
    document.getElementById('darkBtn')?.addEventListener('click',  ()=>root.setAttribute('data-theme','dark'));

    // Expose helpers for compress.js (unchanged names)
    window.__cmpUI__ = {
      setStatus(msg, type){
        const s=document.getElementById('cmpStatus');
        if(!s) return;
        s.className = 'status' + (type ? ' ' + type : '');
        s.textContent = msg || '';
      },
      setProgress(p){
        const box = document.getElementById('cmpProgress');
        const bar = document.getElementById('cmpBar');
        if(!box || !bar) return;
        const show = (p>0 && p<1);
        box.style.display = show ? 'block' : 'none';
        box.setAttribute('aria-hidden', show ? 'false' : 'true');
        bar.style.width = Math.max(0, Math.min(1, p))*100 + '%';
      },
      addPreview(canvas){
        const tray = document.getElementById('cmpTray');
        if(!tray) return;
        if(tray.children.length >= 6) return; // keep it tidy
        const wrap = document.createElement('div');
        wrap.className = 'thumb';
        wrap.appendChild(canvas);
        tray.appendChild(wrap);
      },
      clearPreviews(){
        const tray=document.getElementById('cmpTray');
        if(tray) tray.innerHTML='';
      }
    };

    // Dropzone + file label UX
    (function(){
      const input = document.getElementById('cmpInput');
      const zone  = document.getElementById('dropZone');
      const tag   = document.getElementById('fileTag');

      function fmtBytes(b){
        if(!Number.isFinite(b)) return '';
        const u=['B','KB','MB','GB']; let i=0; while(b>=1024 && i<u.length-1){ b/=1024; i++; }
        return b.toFixed(b<10 && i>0 ? 1 : 0)+' '+u[i];
      }
      function showFileName(f){
        tag.textContent = f ? `${f.name} ‚Ä¢ ${fmtBytes(f.size)}` : 'No file chosen';
        tag.title = f ? tag.textContent : '';
      }

      zone.addEventListener('click', ()=> input.click());
      zone.addEventListener('dragover', (e)=>{ e.preventDefault(); zone.style.borderColor='var(--brand)'; });
      zone.addEventListener('dragleave', ()=>{ zone.style.borderColor='var(--border)'; });
      zone.addEventListener('drop', (e)=>{
        e.preventDefault(); zone.style.borderColor='var(--border)';
        if(e.dataTransfer?.files?.[0]){
          const f = e.dataTransfer.files[0];
          if(!/\.pdf$/i.test(f.name)){
            window.__cmpUI__.setStatus('Please drop a PDF file.', 'warn'); return;
          }
          input.files = e.dataTransfer.files;
          input.dispatchEvent(new Event('change', { bubbles:true }));
        }
      });

      input.addEventListener('change', ()=>{
        const f = input.files?.[0];
        showFileName(f);
        window.__cmpUI__.clearPreviews();
        if(f && !/application\/pdf|\.pdf$/i.test(f.type + f.name)){
          window.__cmpUI__.setStatus('This does not look like a PDF. Please choose a PDF file.', 'warn');
        } else if (f){
          window.__cmpUI__.setStatus('PDF loaded. Choose preset or adjust settings, then press ‚ÄúCompress & Download‚Äù.','ok');
        } else {
          window.__cmpUI__.setStatus('');
        }
      });
    })();

    // Presets that fill the controls (works with your compress.js)
    (function(){
      const chips = Array.from(document.querySelectorAll('.chip'));
      const scale = document.getElementById('cmpScale');
      const qual  = document.getElementById('cmpQuality');

      function setActive(which){
        chips.forEach(c => c.dataset.active = c.dataset.preset === which ? '1' : '0');
      }
      chips.forEach(c=>{
        c.addEventListener('click', ()=>{
          const p = c.dataset.preset;
          if(p === 'max'){ scale.value = '1';   qual.value = '0.9'; }
          if(p === 'bal'){ scale.value = '0.8'; qual.value = '0.8'; }
          if(p === 'small'){ scale.value = '0.6'; qual.value = '0.65'; }
          setActive(p);
        });
      });
    })();
  </script>

  <!-- celebrate (kept last, same relative path from /tools/) -->
  <script src="../assets/celebrate.js"></script>
</body>
</html>
